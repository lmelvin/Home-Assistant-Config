# Turn patio camera off when outside
- alias: 'Turn off cameras when door is open'
  trigger:
    platform: state
    entity_id: binary_sensor.zwone_patio_door
    to: 'on'
  condition:
    condition: state
    entity_id: device_tracker.galaxy_s9
    state: 'home'
  action:
    - service: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.arlo_base

#Turn patio camera on when door shuts
- alias: 'Turn on camera when door closes'
  trigger:
    platform: state
    entity_id: binary_sensor.zwone_patio_door
    to: 'off'
  condition:
    condition: state
    entity_id: device_tracker.galaxy_s9
    state: 'home'
  action:
    - service: alarm_control_panel.alarm_arm_home
      entity_id: alarm_control_panel.arlo_base

# Everyone leaves
- alias: 'Everyone Is Away'
  trigger:
    platform: state
    entity_id: group.all_devices
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 3
      seconds: 0
  action:
    - service: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.arlo_base
    - service: remote.turn_off
      entity_id: group.all_remotes
    - service: switch.turn_off
      entity_id: group.lights
    - service: light.turn_off
      entity_id: group.lights

# Notify when HASS starts up
- alias: 'Home Assistant Startup'
  hide_entity: True
  trigger:
    platform: homeassistant
    event: start
  action:
    service: notify.push
    data:
      message: Home Assistant started.

# Announce when patio door opens
- alias: 'Announce Patio Door Open'
  hide_entity: False
  trigger:
    platform: state
    entity_id: binary_sensor.zwone_patio_door
    from: 'off'
    to: 'on'
  action:
    - service: tts.google_say
      entity_id: media_player.googlehome9280
      data:
        message: Patio Door Opened

# Announce when front door opens
- alias: 'Announce Front Door Open'
  hide_entity: False
  trigger:
    platform: state
    entity_id: binary_sensor.zwtwo_front_door
    from: 'off'
    to: 'on'
  action:
    - service: tts.google_say
      entity_id: media_player.googlehome9280
      data:
        message: Front Door Opened

# Notify when a door opens when nobody is home
- alias: 'Notify When Door Opens While Everyone is Away'
  hide_entity: False
  trigger:
    platform: state
    entity_id: 
      - binary_sensor.zwtwo_front_door
      - binary_sensor.zwone_patio_door
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: group.all_devices
    state: 'not_home'
  action:
    service: notify.push
    data_template:
      message: '{{ trigger.to_state.name }} opened while everyone is away at {{ as_timestamp(now()) | timestamp_custom("%m-%d-%Y %I:%M:%S %p", true) }}'

# Run roomba every day at noon
- alias: Run Roomba
  trigger:
    - platform: time
      at: '12:00:00'
  action:
    service: vacuum.turn_on
    entity_id: vacuum.roomba